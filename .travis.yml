language: node_js
cache: npm
node_js:
  - "10"

services:
  - docker

before_script:
  - npm run setup

script:
  - npm test
  - npm run build
  - docker build -t mongoose-migrate:$TRAVIS_TAG .

deploy:
  - provider: npm
    email: "NPM_EMAIL"
    api_key: "$NPM_TOKEN"
    skip_cleanup: true
    on:
      tags: true

  - provider: script
    script: bash ci/docker_push
    on:
      tags: true
